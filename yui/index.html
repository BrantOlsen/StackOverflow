<head>
    <link rel="stylesheet" type="text/css" href="./css/ui-lightness/jquery-ui-1.10.3.custom.css">
    <style>
        #status {
            margin-top: 10px;
        }
        .ui-progressbar {
            position: relative;
        }
        .progress-label {
            position: absolute;
            left: 50%;
            top: 4px;
            font-weight: bold;
            text-shadow: 1px 1px 0 #fff;
        }
        .file-to-upload {
            margin: 5px;
            padding: 5px;
            border: 1px grey solid;
            display: inline-block;
        }
    </style>

    <script src="jquery-1.10.2.js"></script>
    <script src="./js/jquery-ui-1.10.3.custom.js"></script>
    <script src="./yui/build/yui/yui.js"></script>
</head>
<body>
    <div>Upload Files Test</div>
    <div id="uploaderContainerID"></div>
    <div id="divContainer" style="border: 2px black solid; height: 100px; margin: 10px;" title="Drag files here to upload."></div>
    <div id="selectFilesButtonContainer"></div>
    <div><button id="start_upload">Start Upload</button><button id="clear_upload">Clear File List</button></div>
    <br>
    <div id="progress_bar"><div class="progress-label"></div></div>
    <div id="status"></div>

    <script>
        var uploader = null;
        var pb = $("#progress_bar").progressbar();
        var pb_label = $('.progress-label');

        function populate_status(file_list) {
            var $elem = $('#status');
            var html = '';
            for (var index = 0; index < file_list.length; ++index) {
                html += '<span class="file-to-upload">' + file_list[index].getAttrs().name + '</span>';
            }
            $elem.html(html);
        }

        // Create a YUI sandbox on your page.
        YUI().use('node', 'uploader', 'uploader-flash', function (Y) {
            if (Y.Uploader.TYPE != "none") {
                uploader = new Y.Uploader({
                    width: "300px",
                    height: "40px"
                });
                uploader.set('multipleFiles', true);
                uploader.set('postVarsPerFile', {
                   collection: 'DEV0',
                   collection_id: 45
                });
                uploader.on("totaluploadprogress", function (event) {
                    pb_label.text(event.bytesLoaded + 'B of ' + event.bytesTotal + 'B Uploaded');
                    pb.progressbar( "option", {
                        value: event.percentLoaded
                    });
                });
                uploader.on('alluploadscomplete', function () {
                    Y.log('Upload Complete.');
                    pb_label.text('Upload Complete');
                });
                uploader.on('uploaderror', function (event) {
                    var file_name = event.file.getAttrs().name;
                    $('#status').find(':contains('+file_name+')').css('background-color', 'red');

                    // Indicate an error in the progress bar.
                    pb.progressbar( "option", "value", false );
                });
                uploader.on('uploadcomplete', function (event) {
                    Y.log('Uploaded ' + event.file.getAttrs().name + ' successfully.');
                    var file_name = event.file.getAttrs().name;
                    $('#status').find(':contains('+file_name+')').css('background-color', 'green');
                });
                uploader.on('uploadstart', function () {
                    Y.log('Upload has started');
                    pb_label.text("Uploading...");
                });
                uploader.on('fileselect', function(event) {
                    populate_status(uploader.getAttrs().fileList);
                });

                if (Y.Uploader.TYPE == "html5") {
                    uploader.set("dragAndDropArea", "#divContainer");
                    uploader.render("#selectFilesButtonContainer");
                }
                else if (Y.Uploader.TYPE == "flash") {
                    uploader.set("fileFilters", [{description:"Images", extensions:"*.jpg;*.png;*.gif"},
                                                 {description:"Videos", extensions:"*.avi;*.mov;*.mpg"}]);
                    uploader.render("#selectFilesButtonContainer");
                    $('#divContainer').hide();
                }

                // Add start upload button.
                $('#start_upload').click(function() {
                    uploader.uploadAll("upload.php");
                });

                $('#clear_upload').click(function() {
                   uploader.reset('fileList');
                   populate_status(uploader.getAttrs().fileList);
                });
            }
            else {
                Y.log("No Flash or HTML5 capabilities detected.");
            }
        });
    </script>
</body>
